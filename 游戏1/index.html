<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>é¸Ÿçš„å¤©å ‚ - è§‚å¯Ÿé¡ºåºæŒ‘æˆ˜</title>
    <style>
        /* --- 1. æ ¸å¿ƒå˜é‡ --- */
        :root {
            --primary: #ff2442;
            --success: #4caf50;
            --warning: #ff9800;
            --bg-gradient: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);
            --card-shadow: 0 8px 24px rgba(0,0,0,0.06);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: "Microsoft YaHei", sans-serif;
            background-image: var(--bg-gradient);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            color: #333;
        }

        .app-container {
            width: 98vw; height: 95vh;
            background: #fff; border-radius: 20px; box-shadow: var(--card-shadow);
            display: flex; flex-direction: column; overflow: hidden;
        }

        /* --- é¡¶éƒ¨æ  --- */
        header {
            height: 80px; padding: 0 40px; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 2px solid #f0f0f0; background: #fff;
        }
        .brand { font-size: 26px; font-weight: 800; color: #2c3e50; display: flex; align-items: center; gap: 15px; }
        .brand-tag { background: var(--primary); color: #fff; padding: 4px 12px; border-radius: 8px; font-size: 16px; font-weight: normal; }
        .step-indicator { font-size: 20px; color: #ccc; font-weight: bold; display: flex; gap: 10px; }
        .step-active { color: var(--primary); border-bottom: 2px solid var(--primary); }

        /* --- å·¥ä½œåŒº --- */
        .workspace { flex: 1; display: flex; padding: 30px; gap: 40px; overflow: hidden; align-items: center; justify-content: center; }

        /* === å·¦ä¾§ï¼šç´ æåº“ === */
        .source-area {
            flex: 1; height: 100%;
            background: #f8f9fa; border-radius: 24px; padding: 20px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border: 2px dashed #e0e0e0;
        }
        .source-title { font-size: 24px; font-weight: bold; color: #555; margin-bottom: 40px; }
        
        .gallery-grid { display: flex; gap: 30px; flex-wrap: wrap; justify-content: center; }
        
        /* æ ¸å¿ƒä¿®æ”¹ï¼šå›¾ç‰‡å°ºå¯¸åŠ å¤§ */
        .draggable-img {
            width: 240px;  /* å®½åº¦åŠ å¤§ */
            height: 240px; /* é«˜åº¦åŠ å¤§ */
            border-radius: 20px; cursor: pointer;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            background-size: cover; background-position: center;
            position: relative; transition: transform 0.2s, box-shadow 0.2s;
            background-color: #fff; border: 5px solid white;
        }
        .draggable-img:hover { transform: translateY(-5px) scale(1.02); }
        .draggable-img.selected {
            border-color: var(--primary); transform: scale(1.05); box-shadow: 0 15px 30px rgba(255, 36, 66, 0.3);
        }
        .draggable-img.used { opacity: 0.3; pointer-events: none; filter: grayscale(1); }

        /* === å³ä¾§ï¼šæ‰‹æœºé¢„è§ˆåŒº === */
        .preview-phone {
            width: 480px; height: 100%; /* ç¨å¾®åŠ å®½ */
            background: #fff; border: 4px solid #eee; border-radius: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            display: flex; flex-direction: column; overflow: hidden;
        }
        
        .phone-header { height: 60px; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 18px; color: #333; }
        .editor-content { padding: 30px; flex: 1; display: flex; flex-direction: column; gap: 30px; }

        .title-group { border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .fake-input { font-size: 28px; font-weight: 800; color: #333; border: none; width: 100%; outline: none; }

        /* å›¾ç‰‡æ§½ä½åŒº */
        .slots-wrapper { display: flex; gap: 15px; margin-top: 5px; position: relative; justify-content: space-between; }
        .img-slot {
            width: 130px; height: 130px; /* æ§½ä½ä¹Ÿå¾®è°ƒé€‚åº”å¸ƒå±€ */
            background: #fafafa; border: 2px dashed #ddd; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            color: #ccc; font-size: 40px; font-weight: bold;
            position: relative; transition: 0.3s; cursor: pointer; overflow: hidden;
            background-size: cover; background-position: center;
        }
        .img-slot.active { border-color: var(--primary); background: #fff0f2; }
        .img-slot.correct { border: 4px solid var(--success); }
        .img-slot.wrong { border: 4px solid var(--warning); animation: shake 0.5s ease-in-out; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-8px); }
            40%, 80% { transform: translateX(8px); }
        }

        .btn-check {
            margin-top: auto; background: var(--primary); color: white; border: none;
            padding: 20px; font-size: 22px; font-weight: bold; border-radius: 50px;
            cursor: pointer; box-shadow: 0 5px 15px rgba(255, 36, 66, 0.4);
            transition: 0.2s; width: 100%;
        }
        .btn-check:active { transform: scale(0.98); }

        /* === æˆåŠŸå¼¹çª— === */
        .success-modal {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.98); z-index: 200;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            padding: 40px; text-align: center; animation: fadeIn 0.3s;
        }
        .success-icon { font-size: 100px; margin-bottom: 20px; animation: popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .learning-point {
            background: #e8f5e9; border: 2px solid #c8e6c9; border-radius: 16px;
            padding: 30px; margin: 30px 0; color: #2e7d32; text-align: left; width: 100%;
        }
        .learning-point h3 { margin-bottom: 15px; font-size: 22px; display: flex; align-items: center; gap: 8px; }
        .logic-flow { display: flex; gap: 15px; align-items: center; font-size: 20px; font-weight: bold; margin-top: 15px; justify-content: center; }
        
        @keyframes popIn { 0% { transform: scale(0); } 100% { transform: scale(1); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* æ ‡ç­¾ */
        .img-label {
            position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.6);
            color: white; font-size: 16px; padding: 8px 0; text-align: center;
        }

        /* å ä½æ¸å˜è‰² (å¦‚æœæ²¡æœ‰å›¾ç‰‡æ—¶æ˜¾ç¤º) */
        .gradient-1 { background-image: linear-gradient(120deg, #a1c4fd 0%, #c2e9fb 100%); }
        .gradient-2 { background-image: linear-gradient(120deg, #84fab0 0%, #8fd3f4 100%); }
        .gradient-3 { background-image: linear-gradient(120deg, #43e97b 0%, #38f9d7 100%); }
    </style>
</head>
<body>

<div class="app-container">
    <header>
        <div class="brand">
            <span class="brand-tag">Step 1</span>
            é¸Ÿçš„å¤©å ‚Â·å›¾ç‰‡é€‰æ
        </div>
        <div class="step-indicator">
            <span class="step-active">1. æ•´ç†ç´ æ</span> <span>&rarr;</span> <span style="opacity:0.5">2. æ’°å†™æ–‡æ¡ˆ</span>
        </div>
    </header>

    <div class="workspace">
        
        <!-- å·¦ä¾§ï¼šä¹±åºç´ æåº“ -->
        <div class="source-area">
            <div class="source-title">ğŸ“· ä½ çš„ç›¸æœºèƒ¶å· (ç‚¹å‡»é€‰æ‹©)</div>
            <div class="gallery-grid" id="sourceGallery">
                <!-- JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div style="margin-top: 40px; color: #7f8c8d; font-size: 20px; text-align: center;">
                ğŸ’¡ ä½ ä¼šæŒ‰ä»€ä¹ˆæ ·çš„é¡ºåºæ’åˆ—ç…§ç‰‡ï¼Ÿ
            </div>
        </div>

        <!-- å³ä¾§ï¼šæ‰‹æœºç¼–è¾‘åŒº -->
        <div class="preview-phone">
            <div class="phone-header">å‘å¸ƒç¬”è®°</div>
            <div class="editor-content">
                <div class="title-group">
                    <input type="text" class="fake-input" value="æ¦•æ ‘" readonly>
                </div>

                <div>
                    <div style="font-size:16px; color:#999; margin-bottom:10px; display:flex; justify-content:space-between;">
                        <span>é…å›¾é¡ºåº </span>
                        <span id="slotCount">0/3</span>
                    </div>
                    <div class="slots-wrapper">
                        <div class="img-slot" data-index="0" onclick="handleSlotClick(0)">+</div>
                        <div class="img-slot" data-index="1" onclick="handleSlotClick(1)">+</div>
                        <div class="img-slot" data-index="2" onclick="handleSlotClick(2)">+</div>
                    </div>
                </div>

                <div style="flex:1; background:#f9f9f9; border-radius:16px; padding:25px; color:#ccc; font-size:18px; border:1px solid #eee;">
                    æ–‡æ¡ˆæ’°å†™åŒº... <br><br>
                    (è¯·å…ˆå®Œæˆå›¾ç‰‡æ’åºï¼Œè§£é”å†™ä½œåŠŸèƒ½)
                </div>

                <button class="btn-check" onclick="checkAnswer()">âœ¨ ç¡®è®¤é¡ºåº</button>
            </div>

            <!-- æˆåŠŸå¼¹çª— -->
            <div class="success-modal" id="successModal">
                <div class="success-icon">ğŸ‰</div>
                <h2 style="color:#333; margin-bottom:10px;">é¡ºåºå®Œå…¨æ­£ç¡®ï¼</h2>
                
                <div class="learning-point">
                    <h3>ğŸ’¡ è§‚å¯Ÿçš„ç§˜å¯†</h3>
                    <p>ä½ å‘ç°äº†ä½œè€…çš„è§‚å¯Ÿé€»è¾‘ï¼š</p>
                    <div class="logic-flow">
                        <span>è¿œçœ‹å…¨è²Œ</span> &rarr;
                        <span>è¿‘çœ‹æå¹²</span> &rarr;
                        <span>ç‰¹å†™å¶å­</span>
                    </div>
                </div>
                
                <button class="btn-check" style="width:auto; padding:15px 50px;" onclick="goToWritingPage()">
                    å»å†™æ–‡æ¡ˆ &rarr;
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // ============================================================
    // ğŸ‘‡ğŸ‘‡ğŸ‘‡ å¦‚ä½•è‡ªå®šä¹‰å›¾ç‰‡ (çœ‹è¿™é‡Œ) ğŸ‘‡ğŸ‘‡ğŸ‘‡
    // 
    // 1. å‡†å¤‡ä¸‰å¼ å›¾ç‰‡ï¼Œå‘½åä¸º: far.jpg, near.jpg, leaf.jpg (å»ºè®®jpgæˆ–pngæ ¼å¼)
    // 2. å°†å›¾ç‰‡æ”¾åœ¨å’Œæœ¬ HTML æ–‡ä»¶ã€åŒä¸€ä¸ªæ–‡ä»¶å¤¹ã€‘é‡Œ
    // 3. ä¿®æ”¹ä¸‹æ–¹çš„ 'url' å±æ€§ï¼ŒæŠŠ null æ”¹æˆæ–‡ä»¶åï¼Œä¾‹å¦‚ url: 'far.jpg'
    // ============================================================

    const images = [
        { 
            id: 'far',       // ä¸è¦æ”¹ID
            label: 'æ¦•æ ‘', 
            url: 'tree_far.jpg',       // ğŸ‘‰ è¿™é‡Œæ”¹æˆ 'far.jpg' (å¦‚æœè¿˜æ²¡å›¾ç‰‡ï¼Œä¿ç•™ null ä¼šæ˜¾ç¤ºè“è‰²æ¸å˜)
            bgClass: 'gradient-1', 
            sortIndex: 0 
        },
        { 
            id: 'near',      // ä¸è¦æ”¹ID
            label: 'æå¹²', 
            url: 'tree_near.jpg',       // ğŸ‘‰ è¿™é‡Œæ”¹æˆ 'near.jpg'
            bgClass: 'gradient-2', 
            sortIndex: 1 
        },
        { 
            id: 'leaf',      // ä¸è¦æ”¹ID
            label: 'å¶å­', 
            url: 'tree_leaf.jpg',       // ğŸ‘‰ è¿™é‡Œæ”¹æˆ 'leaf.jpg'
            bgClass: 'gradient-3', 
            sortIndex: 2 
        }
    ];

    // ============================================================
    // ğŸ‘†ğŸ‘†ğŸ‘† é…ç½®ç»“æŸï¼Œä¸‹æ–¹ä»£ç æ— éœ€ä¿®æ”¹ ğŸ‘†ğŸ‘†ğŸ‘†
    // ============================================================

    let currentSlots = [null, null, null];
    let selectedSourceId = null;

    function init() {
        const gallery = document.getElementById('sourceGallery');
        let shuffled = [...images].sort(() => Math.random() - 0.5);
        
        shuffled.forEach(img => {
            const div = document.createElement('div');
            div.className = 'draggable-img';
            div.id = `source-${img.id}`;
            
            // åˆ¤æ–­æ˜¯å¦é…ç½®äº†çœŸå®å›¾ç‰‡
            if (img.url) {
                div.style.backgroundImage = `url('${img.url}')`;
            } else {
                div.classList.add(img.bgClass); // ä½¿ç”¨é»˜è®¤æ¸å˜
            }

            div.innerHTML = `<div class="img-label">${img.label}</div>`;
            div.onclick = () => selectSource(img.id);
            gallery.appendChild(div);
        });
    }

    function selectSource(id) {
        if(currentSlots.includes(id)) { playSound('error'); return; }
        document.querySelectorAll('.draggable-img').forEach(el => el.classList.remove('selected'));
        document.getElementById(`source-${id}`).classList.add('selected');
        selectedSourceId = id;
        playSound('click');
        // æç¤º
        document.querySelectorAll('.img-slot').forEach(s => { 
            if(!s.hasAttribute('data-filled')) s.classList.add('active'); 
        });
    }

    function handleSlotClick(index) {
        document.querySelectorAll('.img-slot').forEach(s => s.classList.remove('active'));
        
        if (selectedSourceId) {
            currentSlots[index] = selectedSourceId;
            renderSlots();
            document.getElementById(`source-${selectedSourceId}`).classList.add('used');
            document.getElementById(`source-${selectedSourceId}`).classList.remove('selected');
            selectedSourceId = null;
            playSound('drop');
        } else if (currentSlots[index]) {
            const returnedId = currentSlots[index];
            currentSlots[index] = null;
            renderSlots();
            document.getElementById(`source-${returnedId}`).classList.remove('used');
            playSound('click');
        }
    }

    function renderSlots() {
        const slots = document.querySelectorAll('.img-slot');
        let count = 0;
        slots.forEach((slot, idx) => {
            const id = currentSlots[idx];
            slot.classList.remove('wrong', 'correct');
            slot.style.backgroundImage = 'none';
            slot.className = 'img-slot'; // reset

            if (id) {
                count++;
                const imgData = images.find(i => i.id === id);
                
                // æ˜¾ç¤ºå›¾ç‰‡
                if (imgData.url) {
                    slot.style.backgroundImage = `url('${imgData.url}')`;
                } else {
                    slot.classList.add(imgData.bgClass);
                }
                
                slot.innerHTML = `<div class="img-label" style="font-size:12px; padding:4px 0;">${imgData.label}</div><div style="position:absolute;top:0;right:0;width:30px;height:30px;background:rgba(0,0,0,0.3);color:#fff;text-align:center;line-height:30px;border-radius:0 0 0 10px;">Ã—</div>`;
                slot.style.border = 'none';
                slot.setAttribute('data-filled', 'true');
            } else {
                slot.innerHTML = '+';
                slot.style.border = '2px dashed #ddd';
                slot.removeAttribute('data-filled');
            }
        });
        document.getElementById('slotCount').innerText = `${count}/3`;
    }

    function checkAnswer() {
        if (currentSlots.includes(null)) {
            alert("è¿˜æœ‰ä½ç½®ç©ºç€å‘¢ï¼Œè¯·å¡«æ»¡ä¸‰å¼ å›¾ç‰‡ï¼");
            return;
        }

        let isAllCorrect = true;
        const slots = document.querySelectorAll('.img-slot');

        currentSlots.forEach((id, idx) => {
            const imgData = images.find(i => i.id === id);
            if (imgData.sortIndex === idx) {
                slots[idx].classList.add('correct');
            } else {
                isAllCorrect = false;
                slots[idx].classList.add('wrong');
                setTimeout(() => slots[idx].classList.remove('wrong'), 500);
            }
        });

        if (isAllCorrect) {
            playSound('success');
            setTimeout(() => { document.getElementById('successModal').style.display = 'flex'; }, 600);
        } else {
            playSound('error');
        }
    }

    function goToWritingPage() {
    // ç›´æ¥è·³è½¬åˆ°åŒä¸€ç›®å½•ä¸‹çš„ writing.html
    window.location.href = "writing.html";
}

    // éŸ³æ•ˆ (AudioContext)
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    let audioCtx = new AudioContext();
    function playSound(type) {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        const now = audioCtx.currentTime;
        if (type === 'click') {
            osc.frequency.setValueAtTime(600, now);
            gain.gain.setValueAtTime(0.05, now);
            osc.frequency.exponentialRampToValueAtTime(300, now+0.1);
            gain.gain.linearRampToValueAtTime(0, now+0.1);
            osc.start(); osc.stop(now+0.1);
        } else if (type === 'drop') {
            osc.frequency.setValueAtTime(400, now);
            gain.gain.setValueAtTime(0.1, now);
            osc.frequency.linearRampToValueAtTime(200, now+0.15);
            gain.gain.linearRampToValueAtTime(0, now+0.15);
            osc.start(); osc.stop(now+0.15);
        } else if (type === 'error') {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, now);
            osc.frequency.linearRampToValueAtTime(100, now+0.3);
            gain.gain.setValueAtTime(0.1, now);
            gain.gain.linearRampToValueAtTime(0, now+0.3);
            osc.start(); osc.stop(now+0.3);
        } else if (type === 'success') {
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(523, now); 
            osc.frequency.setValueAtTime(659, now+0.2); 
            osc.frequency.setValueAtTime(783, now+0.4); 
            gain.gain.setValueAtTime(0.1, now);
            gain.gain.linearRampToValueAtTime(0, now+1.0);
            osc.start(); osc.stop(now+1.0);
        }
    }

    init();
</script>
</body>

</html>
