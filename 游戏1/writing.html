<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>é¸Ÿçš„å¤©å ‚ - é™æ€æå†™åˆ›ä½œå°</title>
    <style>
        /* --- 1. å…¨å±€è®¾ç½® --- */
        :root {
            --primary: #ff2442; 
            --accent: #2c3e50;
            --bg-gradient: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);
            --card-shadow: 0 8px 24px rgba(0,0,0,0.06);
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: "Microsoft YaHei", sans-serif;
            background-image: var(--bg-gradient);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            color: #333;
        }

        /* --- 2. ä¸»å®¹å™¨ --- */
        .app-container {
            width: 98vw;
            height: 95vh;
            background: #fff;
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- 3. é¡¶éƒ¨æ  --- */
        header {
            height: 80px;
            padding: 0 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #f0f0f0;
            background: #fff;
        }
        .brand { font-size: 26px; font-weight: 800; color: var(--accent); display: flex; align-items: center; gap: 15px; }
        .brand-tag { background: var(--primary); color: #fff; padding: 4px 12px; border-radius: 8px; font-size: 16px; font-weight: normal; }
        
        .actions { display: flex; gap: 20px; }
        .btn { padding: 12px 30px; border-radius: 12px; font-size: 20px; cursor: pointer; border: none; font-weight: bold; transition: 0.2s; }
        .btn-ghost { background: #f5f7fa; color: #666; }
        .btn-primary { background: var(--primary); color: #fff; box-shadow: 0 4px 15px rgba(255, 36, 66, 0.4); }
        .btn-primary:active { transform: scale(0.95); }

        /* --- 4. å·¥ä½œåŒºå¸ƒå±€ --- */
        .workspace {
            flex: 1;
            display: flex;
            padding: 30px;
            gap: 40px;
            overflow: hidden;
        }

        /* === å·¦ä¾§ï¼šè§†è§‰ä¸å¼•å¯¼åŒº === */
        .left-panel {
            flex: 4;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* å›¾ç‰‡å±•ç¤ºåŒº */
        .gallery-container {
            flex: 5;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: #fff;
            border-radius: 16px;
        }
        
        .main-image {
            flex: 1;
            background-color: #eee;
            border-radius: 16px;
            background-size: cover;
            background-position: center;
            border: 2px solid #e0e0e0;
            position: relative;
            transition: background-image 0.3s ease;
        }

        .thumbnail-row {
            height: 90px;
            display: flex;
            gap: 15px;
        }
        .thumb {
            flex: 1;
            background-color: #f0f0f0;
            border-radius: 12px;
            cursor: pointer;
            border: 3px solid transparent;
            background-size: cover;
            background-position: center;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        .thumb:hover { transform: translateY(-3px); }
        .thumb.active { border-color: var(--primary); }
        .thumb::after { content: attr(data-label); position: absolute; bottom: 0; left: 0; width: 100%; background: rgba(0,0,0,0.5); color: white; font-size: 14px; text-align: center; padding: 4px 0; }

        /* å¼•å¯¼å¡ç‰‡å®¹å™¨ */
        .guide-card {
            flex: 4;
            background: #fff;
            border: 2px solid #eee;
            border-radius: 16px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        /* Tab å¯¼èˆªæ ·å¼ */
        .guide-tabs {
            display: flex;
            background: #f5f5f5;
            padding: 6px;
            border-radius: 12px;
            margin-bottom: 20px;
            flex-shrink: 0;
        }
        .tab-item {
            flex: 1;
            text-align: center;
            padding: 12px 0;
            font-size: 18px;
            font-weight: bold;
            color: #666;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .tab-item.active {
            background: #fff;
            color: var(--primary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* å†…å®¹æ˜¾ç¤ºæ§åˆ¶ */
        .tab-content { display: none; animation: fadeIn 0.3s; height: 100%; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* ä»¿å°çº¢ä¹¦èŒƒæ–‡å¡ç‰‡ */
        .xhs-card { background: #fff; height: 100%; display: flex; flex-direction: column; }
        .xhs-title { font-size: 20px; font-weight: 900; color: #333; margin-bottom: 15px; line-height: 1.4; }
        .xhs-body { font-size: 18px; color: #444; line-height: 1.7; text-align: justify; flex: 1; overflow-y: auto; }
        .highlight-text { background: linear-gradient(to bottom, transparent 60%, #fff176 60%); color: #333; font-weight: bold; padding: 0 2px; }
        .xhs-footer { margin-top: 15px; border-top: 1px solid #f0f0f0; padding-top: 10px; display: flex; justify-content: space-between; color: #999; font-size: 14px; }

        /* å†™ä½œå¯¼èˆª (æµç¨‹å›¾) */
        .flow-steps { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .step-box { background: #f9f9f9; padding: 15px 10px; border-radius: 10px; font-size: 18px; font-weight: bold; color: #555; text-align: center; width: 42%; border: 1px solid #eee; }
        .step-box.highlight { color: var(--primary); border: 1px solid #ffcdd2; background: #fff0f2; }
        .step-arrow { font-size: 24px; color: #d69e2e; font-weight: bold; }
        .small-tip { font-size: 16px; color: #856404; text-align: center; padding: 10px; background: #fff3cd; border-radius: 8px; margin-top: 10px; }

        /* === å³ä¾§ï¼šåˆ›ä½œåŒº === */
        .right-panel {
            flex: 6;
            display: flex;
            flex-direction: column;
            background: #fff;
            border-radius: 20px;
            border: 2px solid #e5e7eb;
            box-shadow: 0 4px 20px rgba(0,0,0,0.03);
            position: relative;
        }
        .editor-header {
            padding: 20px 30px;
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
            border-radius: 20px 20px 0 0;
            color: #6b7280;
            font-size: 18px;
            font-weight: bold;
        }
        .text-area-wrapper { flex: 1; position: relative; }
        textarea {
            width: 100%; height: 100%; border: none; outline: none; padding: 30px;
            font-size: 24px; /* è¶…å¤§å­—å·é€‚é…ç™½æ¿ */
            line-height: 2.0; /* å®½æ¾è¡Œè· */
            color: #374151; resize: none;
            background-image: linear-gradient(transparent 96%, #e5e7eb 97%);
            background-size: 100% 48px; /* è¡Œé«˜åŒ¹é… */
            background-attachment: local;
        }
        textarea::placeholder { color: #ccc; }

        /* åº•éƒ¨å·¥å…·æ  */
        .editor-toolbar {
            height: 80px;
            border-top: 2px solid #e5e7eb;
            display: flex;
            align-items: center;
            padding: 0 30px;
            gap: 15px; /* æŒ‰é’®é—´è· */
            background: #fff;
            border-radius: 0 0 20px 20px;
        }
        .tool-btn {
            display: flex; align-items: center; gap: 10px;
            padding: 10px 20px; border-radius: 30px;
            border: 2px solid #e5e7eb; background: #fff;
            color: #555; font-size: 18px; font-weight: bold;
            cursor: pointer; transition: 0.2s;
        }
        .tool-btn:active { transform: scale(0.95); }
        /* é’ˆå¯¹ä¸åŒæŒ‰é’®çš„é¢œè‰²åŒºåˆ† */
        .tool-btn.btn-vocab { border-color: #4caf50; color: #2e7d32; background: #e8f5e9; }
        .tool-btn.btn-sent { border-color: #2196f3; color: #1565c0; background: #e3f2fd; }
        
        .mic-active { animation: pulse 1.5s infinite; background: var(--primary); color: white; border-color: var(--primary); }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 36, 66, 0.4); } 100% { box-shadow: 0 0 0 15px rgba(255, 36, 66, 0); } }

        /* --- 5. é”¦å›Šå¼¹çª— --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5); z-index: 500;
            display: none; justify-content: center; align-items: center;
            backdrop-filter: blur(5px);
        }
        .modal-overlay.active { display: flex; animation: fadeIn 0.2s; }
        
        .modal-card {
            background: #fff;
            width: 800px;
            max-width: 90%;
            border-radius: 24px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.25);
            padding: 40px;
            display: flex; flex-direction: column;
            transform: scale(0.95); transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .modal-overlay.active .modal-card { transform: scale(1); }
        
        .modal-header { display: flex; justify-content: space-between; margin-bottom: 30px; align-items: center; }
        .modal-title { font-size: 28px; font-weight: 800; color: #333; }
        .close-icon { font-size: 36px; color: #999; cursor: pointer; padding: 10px; }
        
        .tag-cloud { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; }
        .tag {
            background: #f0fdf4; color: #15803d; border: 2px solid #bbf7d0;
            padding: 15px 30px; border-radius: 50px; font-size: 24px; font-weight: bold;
            cursor: pointer; transition: 0.2s;
        }
        .tag:active { background: #22c55e; color: white; transform: scale(0.95); }
        
        .sentence-list { display: flex; flex-direction: column; gap: 20px; }
        .sentence-group-title { font-size: 18px; color: #666; font-weight: bold; margin-bottom: -10px; margin-left: 5px; }
        .sentence {
            padding: 25px; background: #e3f2fd; border: 2px solid #bbdefb; border-radius: 16px;
            cursor: pointer; font-size: 22px; line-height: 1.6; color: #0d47a1; position: relative;
        }
        .sentence:active { background: #bbdefb; border-color: #2196f3; }
        .sentence::after { content: "ğŸ“ ç‚¹å‡»ä½¿ç”¨"; position: absolute; right: 20px; bottom: 10px; font-size: 14px; color: #1976d2; opacity: 0.6; }

        /* --- 6. æˆåŠŸå‘å¸ƒé¡µ --- */
        .success-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff;
            z-index: 600; display: flex; flex-direction: column; align-items: center; justify-content: center;
            transform: translateY(100%); transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .success-overlay.active { transform: translateY(0); }
        .badge { font-size: 80px; margin-bottom: 20px; animation: bounce 1s infinite alternate; }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-20px); } }
        .comment-wall { width: 700px; margin-top: 40px; background: #f9fafb; border-radius: 20px; padding: 30px; }
        .comment-item { display: flex; gap: 20px; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #eee; animation: slideUp 0.5s backwards; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .toast {
            position: fixed; bottom: 150px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.85); color: white; padding: 20px 50px;
            border-radius: 50px; font-size: 24px; pointer-events: none; opacity: 0; transition: 0.3s; z-index: 800;
        }
    </style>
</head>
<body>

<div class="app-container">
    <header>
        <div class="brand">
            <span class="brand-tag">äº”å¹´çº§è¯­æ–‡</span>
            é¸Ÿçš„å¤©å ‚Â·é™æ€æå†™
        </div>
        <div class="actions">
            <button class="btn btn-ghost" onclick="resetApp()">é‡ç½®</button>
            <button class="btn btn-primary" onclick="handlePublish()">å‘å¸ƒç¬”è®°</button>
        </div>
    </header>

    <div class="workspace">
        <!-- å·¦ä¾§ï¼šè§†è§‰ + å¼•å¯¼ -->
        <aside class="left-panel">
            <!-- 1. å¤šå›¾ç”»å»Š -->
            <div class="gallery-container">
                <div class="main-image" id="mainImage"></div>
                <div class="thumbnail-row">
                    <div class="thumb active" 
                         onclick="switchImage(this, 'tree_far.jpg')" 
                         data-label="è¿œæ™¯Â·å…¨è²Œ" 
                         style="background-image: url('tree_far.jpg');">
                    </div>
                    <div class="thumb" 
                         onclick="switchImage(this, 'tree_near.jpg')" 
                         data-label="è¿‘æ™¯Â·æå¹²" 
                         style="background-image: url('tree_near.jpg');">
                    </div>
                    <div class="thumb" 
                         onclick="switchImage(this, 'tree_leaf.jpg')" 
                         data-label="ç‰¹å†™Â·å¶å­" 
                         style="background-image: url('tree_leaf.jpg');">
                    </div>
                </div>
            </div>
            
            <!-- 2. ä»»åŠ¡å¼•å¯¼ & èŒƒæ–‡å±•ç¤º (Tab åˆ‡æ¢ç‰ˆ) -->
            <div class="guide-card">
                <!-- Tab åˆ‡æ¢æŒ‰é’® -->
                <div class="guide-tabs">
                    <div class="tab-item active" onclick="switchGuideTab(this, 'model')">ğŸ“ èŒƒæ–‡æ¡ˆä¾‹</div>
                    <div class="tab-item" onclick="switchGuideTab(this, 'guide')">ğŸ§­ å†™ä½œå¯¼èˆª</div>
                </div>

                <!-- å†…å®¹åŒºåŸŸ Aï¼šèŒƒæ–‡æ¡ˆä¾‹ (é»˜è®¤æ˜¾ç¤º) -->
                <div id="tabContentModel" class="tab-content active">
                    <div class="xhs-card">
                        <div class="xhs-title">ç»äº†ï¼å­¦æ ¡åå±±å±…ç„¶è—ç€ä¸€ç‰‡è«å¥ˆèŠ±å›­ï¼ŸğŸŒ¸</div>
                        <div class="xhs-body">
                            å®¶äººä»¬ï¼Œè°æ‡‚å•Šï¼ä»Šå¤©è·¯è¿‡å­¦æ ¡åå±±ï¼Œè¯¯å…¥ä»™å¢ƒï¼è¿™é‡Œçš„è·èŠ±å¼€å¾—å¤ªç–¯äº†ï¼
                            <br><br>
                            <span class="highlight-text">è¿œè¿œæœ›å»ï¼Œåƒä¸€æŠŠæŠŠç²‰è‰²çš„å¤§ä¼æ’‘åœ¨æ°´é¢ä¸Šã€‚</span>
                            <br><br>
                            <span class="highlight-text">å‡‘è¿‘ä¸€çœ‹ï¼Œè·å¶ä¸Šè¿˜æ»šç€æ°´ç ï¼Œä»¿ä½›æ˜¯åˆšç¡é†’çš„ç²¾çµåœ¨çœ¨çœ¼ç›âœ¨ã€‚</span>
                        </div>
                        <div class="xhs-footer">
                            <span>â¤ï¸ 1.2w</span>
                            <span>â­ 5602</span>
                            <span>ğŸ’¬ 899</span>
                        </div>
                    </div>
                </div>

                <!-- å†…å®¹åŒºåŸŸ Bï¼šå†™ä½œå¯¼èˆª (æµç¨‹å›¾) -->
                <div id="tabContentGuide" class="tab-content">
                    <div style="font-size: 20px; font-weight: bold; margin-bottom: 20px; color:#b7791f; text-align:center;">ğŸ“ è§‚å¯Ÿä¸å†™ä½œé¡ºåº</div>
                    <div class="flow-steps">
                        <div class="step-box highlight">ğŸ‘€ è¿œçœ‹</div>
                        <div class="step-arrow">â¡</div>
                        <div class="step-box highlight">ğŸ” è¿‘çœ‹</div>
                    </div>
                    <div class="flow-steps">
                        <div class="step-box">ğŸŒ³ æ•´ä½“æ ·å­</div>
                        <div class="step-arrow">â¡</div>
                        <div class="step-box">ğŸƒ æå¶ç»†èŠ‚</div>
                    </div>
                    <div class="small-tip">
                        ğŸ’¡ æç¤ºï¼šå…ˆç”¨ä¸€å¥è¯æ¦‚æ‹¬æ ‘çš„å¤§ï¼Œ<br>å†å…·ä½“æå†™æå¹²å’Œå¶å­çš„ç”Ÿå‘½åŠ›ã€‚
                    </div>
                </div>
            </div>
        </aside>

        <!-- å³ä¾§ï¼šç¼–è¾‘åŒº -->
        <main class="right-panel">
            <div class="editor-header">ğŸ“ æˆ‘çš„è§‚å¯Ÿç¬”è®°</div>
            <div class="text-area-wrapper">
                <textarea id="noteInput" placeholder="æˆ‘ä»¬çš„èˆ¹æ¸æ¸é€¼è¿‘æ¦•æ ‘äº†ã€‚æˆ‘æœ‰æœºä¼šçœ‹æ¸…å®ƒçš„çœŸé¢ç›®ã€‚&#10;çœŸæ˜¯ä¸€æ ªå¤§æ ‘ï¼Œæå¹²çš„æ•°ç›®ä¸å¯è®¡æ•°â€¦â€¦"></textarea>
            </div>
            <div class="editor-toolbar">
                <div class="tool-btn" id="micBtn" onclick="toggleSpeech()"><span>ğŸ¤</span> è¯­éŸ³è¾“å…¥</div>
                
                <!-- é‡ç‚¹ä¿®æ”¹ï¼šæ‹†åˆ†ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„æŒ‰é’® -->
                <div class="tool-btn btn-vocab" onclick="openModal('vocab')">âœ¨ å¥½è¯ç§¯ç´¯</div>
                <div class="tool-btn btn-sent" onclick="openModal('sentence')">ğŸ“ ä½³å¥æ¨¡æ¿</div>
                
                <div style="flex:1"></div>
                <div style="font-size:16px; color:#999; font-weight:bold;" id="wordCount">0 å­—</div>
            </div>
        </main>
    </div>
</div>

<!-- é”¦å›Šå¼¹çª— -->
<div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
    <div class="modal-card" onclick="event.stopPropagation()">
        <div class="modal-header">
            <span class="modal-title" id="modalTitle">âœ¨ è¯æ±‡å®åº“</span>
            <span class="close-icon" onclick="closeModal()">Ã—</span>
        </div>
        <div id="modalContent"></div>
    </div>
</div>

<!-- æˆåŠŸé¡µ -->
<div class="success-overlay" id="successPage">
    <div class="badge">ğŸ†</div>
    <h1 style="font-size:40px; margin-bottom:10px;">å‘å¸ƒæˆåŠŸï¼</h1>
    <p style="font-size:24px; color:#666;">è·å¾—â€œå°å°è§‚å¯Ÿå®¶â€ç§°å·</p>
    <div class="comment-wall">
        <div style="font-weight:bold; font-size:20px; margin-bottom:20px; color:#555;">ç²¾é€‰è¯„è®º</div>
        <div id="commentList"></div>
    </div>
    <button class="btn btn-primary" style="margin-top:40px; font-size:24px;" onclick="resetApp()">å†å†™ä¸€ç¯‡</button>
    <canvas id="fireworks" style="position:absolute;top:0;left:0;pointer-events:none;"></canvas>
</div>

<div class="toast" id="toast">æç¤ºæ¶ˆæ¯</div>

<script>
    // --- 1. å›¾ç‰‡åˆ‡æ¢é€»è¾‘ ---
    const mainImg = document.getElementById('mainImage');
    mainImg.style.backgroundImage = "url('tree_far.jpg')"; 

    function switchImage(el, imageUrl) {
        document.querySelectorAll('.thumb').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
        const mainBox = document.getElementById('mainImage');
        mainBox.style.backgroundImage = `url('${imageUrl}')`;
        playSound('click');
    }

    // --- 2. Tab åˆ‡æ¢ logic ---
    function switchGuideTab(btn, targetId) {
        playSound('click');
        document.querySelectorAll('.tab-item').forEach(item => item.classList.remove('active'));
        btn.classList.add('active');
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        if (targetId === 'model') {
            document.getElementById('tabContentModel').classList.add('active');
        } else {
            document.getElementById('tabContentGuide').classList.add('active');
        }
    }

    // --- 3. é”¦å›Šé€»è¾‘ (æ‹†åˆ†ä¸ºç‹¬ç«‹åŠŸèƒ½) ---
    const vocabData = ["ç‹¬æœ¨æˆæ—", "ä¸å¯è®¡æ•°", "ç”Ÿæœºå‹ƒå‹ƒ", "æç¹å¶èŒ‚", "ç¿ ç»¿", "é¢¤åŠ¨", "å§åœ¨æ°´é¢", "ç°‡æ‹¥"];
    const sentenceData = [
        { title: "ğŸ”­ ç”±è¿œåŠè¿‘Â·ç©ºé—´é¡ºåº", text: "è¿œçœ‹ï¼Œå¤§æ¦•æ ‘åƒâ€¦â€¦ï¼›èµ°è¿‘ä¸€çœ‹ï¼ŒåŸæ¥â€¦â€¦" },
        { title: "ğŸŒ³ æ•´ä½“åˆ°å±€éƒ¨Â·é€»è¾‘é¡ºåº", text: "è¿™çœŸæ˜¯ä¸€æ£µâ€¦â€¦çš„æ¦•æ ‘ï¼ä½ çœ‹é‚£æå¹²â€¦â€¦ï¼Œå†çœ‹é‚£å¶å­â€¦â€¦" },
        { title: "ğŸƒ é™æ€æå†™Â·ç»†èŠ‚ç‰¹å†™", text: "é‚£ä¹ˆå¤šâ€¦â€¦ï¼Œä¸€ç°‡å †åœ¨å¦ä¸€ç°‡ä¸Šé¢ï¼Œä¸ç•™ä¸€ç‚¹å„¿â€¦â€¦" }
    ];

    function openModal(type) {
        playSound('click');
        const overlay = document.getElementById('modalOverlay');
        const title = document.getElementById('modalTitle');
        const content = document.getElementById('modalContent');
        overlay.classList.add('active');
        content.innerHTML = '';

        if (type === 'vocab') {
            title.textContent = "âœ¨ è¯æ±‡å®åº“ (ç‚¹å‡»æ’å…¥)";
            const box = document.createElement('div');
            box.className = 'tag-cloud';
            vocabData.forEach(word => {
                const tag = document.createElement('div');
                tag.className = 'tag';
                tag.textContent = word;
                tag.onclick = () => { insertText(word); closeModal(); };
                box.appendChild(tag);
            });
            content.appendChild(box);
        } else if (type === 'sentence') {
            title.textContent = "ğŸ“ ç©ºé—´æå†™æ¨¡ç‰ˆ (ç‚¹å‡»æ’å…¥)";
            const list = document.createElement('div');
            list.className = 'sentence-list';
            sentenceData.forEach(item => {
                const groupTitle = document.createElement('div');
                groupTitle.className = 'sentence-group-title';
                groupTitle.textContent = item.title;
                list.appendChild(groupTitle);

                const div = document.createElement('div');
                div.className = 'sentence';
                div.textContent = item.text;
                div.onclick = () => { insertText(item.text); closeModal(); };
                list.appendChild(div);
            });
            content.appendChild(list);
        }
    }

    // --- 4. é€šç”¨é€»è¾‘ ---
    const input = document.getElementById('noteInput');
    input.addEventListener('input', () => {
        document.getElementById('wordCount').textContent = input.value.length + " å­—";
    });

    function insertText(txt) {
        playSound('click');
        const start = input.selectionStart;
        input.value = input.value.slice(0, start) + txt + input.value.slice(input.selectionEnd);
        input.focus();
        document.getElementById('wordCount').textContent = input.value.length + " å­—";
    }

    function closeModal(e) {
        if (e && e.target !== document.getElementById('modalOverlay')) return;
        document.getElementById('modalOverlay').classList.remove('active');
    }

    function resetApp() {
        if(confirm('ç¡®å®šè¦æ¸…ç©ºé‡å†™å—ï¼Ÿ')) {
            location.reload();
        }
    }

    // éŸ³æ•ˆå¼•æ“
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    let audioCtx = new AudioContext();
    function playSound(type) {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        if(type === 'click') {
            osc.frequency.setValueAtTime(600, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(300, audioCtx.currentTime+0.1);
            gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime+0.1);
            osc.start(); osc.stop(audioCtx.currentTime+0.1);
        } else if (type==='success') {
            osc.type='triangle';
            osc.frequency.setValueAtTime(440, audioCtx.currentTime);
            osc.frequency.setValueAtTime(880, audioCtx.currentTime+0.2);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime+1);
            osc.start(); osc.stop(audioCtx.currentTime+1);
        }
    }

    // è¯­éŸ³è¾“å…¥
    let recognition;
    const micBtn = document.getElementById('micBtn');
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.lang = 'zh-CN';
        recognition.onstart = () => { micBtn.classList.add('mic-active'); showToast('è¯·è¯´è¯...'); };
        recognition.onend = () => { micBtn.classList.remove('mic-active'); };
        recognition.onresult = (e) => insertText(e.results[0][0].transcript);
    }

    function toggleSpeech() {
        playSound('click');
        if(recognition) recognition.start();
        else alert('æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³');
    }

    function showToast(msg) {
        const t = document.getElementById('toast');
        t.innerText = msg; t.style.opacity = 1;
        setTimeout(()=>t.style.opacity=0, 2000);
    }

    // å‘å¸ƒä¸çƒŸèŠ±
    function handlePublish() {
        playSound('click');
        if(input.value.length < 5) { showToast('å­—æ•°å¤ªå°‘å•¦ï¼Œå¤šå†™ç‚¹å§ï¼'); return; }
        
        playSound('success');
        document.getElementById('successPage').classList.add('active');
        
        const list = document.getElementById('commentList');
        const comments = [
            {n:"å·´é‡‘çˆ·çˆ·", t:"è§‚å¯Ÿå¾—çœŸä»”ç»†ï¼è¿™æ­£æ˜¯æˆ‘æƒ³è¡¨è¾¾çš„ç”Ÿå‘½åŠ›ï¼", i:"ğŸ‘´"},
            {n:"è¯­æ–‡è€å¸ˆ", t:"ç”¨è¯å‡†ç¡®ï¼Œé¡ºåºæ¸…æ™°ï¼Œå¾ˆæ£’ï¼", i:"ğŸ‘©â€ğŸ«"},
            {n:"å­¦ä¹ å§”å‘˜", t:"è¿™æ£µæ ‘è¢«ä½ å†™æ´»äº†ï¼", i:"ğŸŒŸ"}
        ];
        list.innerHTML = '';
        comments.forEach((c, i) => {
            setTimeout(() => {
                const row = document.createElement('div');
                row.className = 'comment-item';
                row.innerHTML = `<div style="font-size:30px">${c.i}</div><div><div style="font-weight:bold;font-size:18px;color:#333">${c.n}</div><div style="font-size:20px;color:#666">${c.t}</div></div>`;
                list.appendChild(row);
                playSound('click');
            }, i*800 + 500);
        });
        startFireworks();
    }

    function startFireworks() {
        const c = document.getElementById('fireworks');
        const x = c.getContext('2d');
        c.width = window.innerWidth; c.height = window.innerHeight;
        let p = [];
        setInterval(() => {
            if(p.length < 100) {
                for(let i=0;i<20;i++) p.push({x:Math.random()*c.width, y:Math.random()*c.height/2, vx:(Math.random()-.5)*10, vy:(Math.random()-.5)*10, l:100, c:`hsl(${Math.random()*360},100%,50%)`});
            }
        }, 500);
        function loop() {
            x.clearRect(0,0,c.width,c.height);
            p.forEach((i,k)=>{
                i.x+=i.vx; i.y+=i.vy; i.vy+=0.1; i.l--;
                x.globalAlpha=i.l/100; x.fillStyle=i.c;
                x.beginPath(); x.arc(i.x,i.y,4,0,6.28); x.fill();
                if(i.l<=0) p.splice(k,1);
            });
            requestAnimationFrame(loop);
        }
        loop();
    }
</script>
</body>
</html>
